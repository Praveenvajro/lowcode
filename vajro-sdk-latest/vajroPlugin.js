var vajroPlugin;(()=>{"use strict";var t={d:(r,o)=>{for(var e in o)t.o(o,e)&&!t.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:o[e]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};t.r(r),t.d(r,{flow:()=>_});var o=function(){return o=Object.assign||function(t){for(var r,o=1,e=arguments.length;o<e;o++)for(var i in r=arguments[o])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},o.apply(this,arguments)},e=function(t,r,o){if(o||2===arguments.length)for(var e,i=0,n=r.length;i<n;i++)!e&&i in r||(e||(e=Array.prototype.slice.call(r,0,i)),e[i]=r[i]);return t.concat(e||Array.prototype.slice.call(r))},i=function(t){return t.reduce((function(t,r){var i,n,a=r.offerCategory;return t[a]?o(o({},t),((i={})[a]=e(e([],t[a],!0),[r],!1),i)):o(o({},t),((n={})[a]=[r],n))}),{automaticOffers:[],buyXGetY:[],percentageDiscount:[],flatDiscount:[]})},n=function(t){return t.reduce((function(t,r){return t[r.variantId]=r,t}),{})},a=function(t){return t.reduce((function(t,r){var e=r.unitPrice,i=void 0===e?0:e,n=r.quantity,a=void 0===n?0:n,c=r.customAttributes,u=(void 0===c?{}:c)._vajro_flow,d=void 0===u?{}:u,l=("string"==typeof d?JSON.parse(d):o({},d))||{},f=l._actualUnitPrice,s=void 0===f?i:f,v=l._discountQuantity,p=void 0===v?0:v,y=l._freeQuantity;return t+s*(a-(Number(void 0===y?0:y)+Number(p)))}),0)},c=function(t){return t.reduce((function(t,r){var o=r.quantity,e=void 0===o?0:o,i=r.freeQuantity;return t+(e-(void 0===i?0:i))}),0)},u=function(){return u=Object.assign||function(t){for(var r,o=1,e=arguments.length;o<e;o++)for(var i in r=arguments[o])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},u.apply(this,arguments)},d=function(t,r,o){if(o||2===arguments.length)for(var e,i=0,n=r.length;i<n;i++)!e&&i in r||(e||(e=Array.prototype.slice.call(r,0,i)),e[i]=r[i]);return t.concat(e||Array.prototype.slice.call(r))},l=function(){return l=Object.assign||function(t){for(var r,o=1,e=arguments.length;o<e;o++)for(var i in r=arguments[o])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},l.apply(this,arguments)},f=function(t,r,o){if(o||2===arguments.length)for(var e,i=0,n=r.length;i<n;i++)!e&&i in r||(e||(e=Array.prototype.slice.call(r,0,i)),e[i]=r[i]);return t.concat(e||Array.prototype.slice.call(r))},s=function(){return s=Object.assign||function(t){for(var r,o=1,e=arguments.length;o<e;o++)for(var i in r=arguments[o])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},s.apply(this,arguments)},v=function(t,r,o){if(o||2===arguments.length)for(var e,i=0,n=r.length;i<n;i++)!e&&i in r||(e||(e=Array.prototype.slice.call(r,0,i)),e[i]=r[i]);return t.concat(e||Array.prototype.slice.call(r))},p=function(){return p=Object.assign||function(t){for(var r,o=1,e=arguments.length;o<e;o++)for(var i in r=arguments[o])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},p.apply(this,arguments)},y=function(t,r,o){if(o||2===arguments.length)for(var e,i=0,n=r.length;i<n;i++)!e&&i in r||(e||(e=Array.prototype.slice.call(r,0,i)),e[i]=r[i]);return t.concat(e||Array.prototype.slice.call(r))},m=function(){return m=Object.assign||function(t){for(var r,o=1,e=arguments.length;o<e;o++)for(var i in r=arguments[o])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},m.apply(this,arguments)},b=function(t,r,o){if(o||2===arguments.length)for(var e,i=0,n=r.length;i<n;i++)!e&&i in r||(e||(e=Array.prototype.slice.call(r,0,i)),e[i]=r[i]);return t.concat(e||Array.prototype.slice.call(r))},_=function(t,r){var _={},g=t.cartLineItems.lineItems,h=void 0===g?[]:g,O=function(t,r){var o=[],i=[];return t.forEach((function(t){var u=n(r),d=t.cartType,l=t.cartValue,f=t.buyOfferType,s=t.buyProducts,v=t.buyCollections,p=(t.getOfferType,t.discountType,t.getProductCount,t.reccuringFreeProduct,t.getProducts,[]);"products"===f?s.forEach((function(t){var r=t.variantId;u[r]&&(p=e(e([],p,!0),[u[r]],!1))})):"collections"===f?v.forEach((function(t){var o=t.collectionId,i=r.filter((function(t){return o===t.collectionId}));i.length>0&&(p=e(e([],p,!0),i,!0))})):p=r,("amount"===d?a(p):c(p))>=l?o=e(e([],o,!0),[t],!1):i=e(e([],i,!0),[t],!1)})),{validConfigList:o,inValidConfigList:i}}(r,h).validConfigList,I=O.reduce((function(t,r,i){var n=t.combinedOfferConfig,a=t.nonCombinedOfferConfig,c=r.combinedOffer;return o(o({},t),c?{combinedOfferConfig:e(e([],n,!0),[o(o({},r),{index:i})],!1)}:{nonCombinedOfferConfig:e(e([],a,!0),[o(o({},r),{index:i})],!1)})}),{combinedOfferConfig:[],nonCombinedOfferConfig:[]}),P=I.combinedOfferConfig,A=void 0===P?[]:P,j=I.nonCombinedOfferConfig,T=void 0===j?[]:j,w=function(t){return t.reduce((function(t,r){var e,i=r.variantId,n=r.customAttributes,a=void 0===n?{}:n,c=a._vajro_flow,u=void 0===c?{}:c,d="string"==typeof u?JSON.parse(u):o({},u);return-1!==Object.keys(d).indexOf("_actualUnitPrice")?o(o({},t),((e={})[i]=o(o({},r),{customAttributes:o(o({},a),{_vajro_flow:d})}),e)):t}),{})}(h),N={};(null==A?void 0:A.length)>0&&(N.combinedOffer=i(A)),T.forEach((function(t,r){var o=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"offer".concat(r);N[o]=i([t])})),Object.entries(N).forEach((function(t){var r=t[0],o=t[1],e={};Object.entries(o).forEach((function(t){var r=t[0],o=t[1];if(0!==o.length)switch(r){case"automaticOffers":e=function(t,r,o){var e=n(r),i=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"freeOfferTarget";return t.forEach((function(t){var n=t.cartType,l=t.cartValue,f=t.buyOfferType,s=t.buyProducts,v=t.buyCollections,p=t.getProductCount,y=t.reccuringFreeProduct,m=t.getProducts,b=t.displayText,_=[];"products"===f?s.forEach((function(t){var r=t.variantId;e[r]&&(_=d(d([],_,!0),[e[r]],!1))})):"collections"===f?v.forEach((function(t){var o=t.collectionId,e=r.filter((function(t){return o===t.collectionId}));e.length>0&&(_=d(d([],_,!0),e,!0))})):_=r;var g="amount"===n?a(_):c(_);if(g>=l){var h=y?Math.floor(g/l)*p:p;m.forEach((function(t){var r,n,a=t.variantId,c=t.productId,l=t.productPrice,f=o[a],s=e[a]||{},v=s.lineItemHandle,p=s.quantity,y=void 0===p?0:p,m=s.customAttributes,_=(void 0===m?{}:m)._vajro_flow,g=void 0===_?{}:_,O="string"==typeof g?JSON.parse(g):u({},g),I=O._freeQuantity,P=void 0===I?0:I,A=y?Number(y)-Number(P):0,j=f||{},T=j.customAttributes,w=(void 0===T?{}:T)._vajro_flow,N=void 0===w?{}:w,U=j.displayTextDetails,D=void 0===U?[]:U;h&&f?o=u(u({},o),((r={})[a]=u(u({},f),{displayTextDetails:D.includes(b)?D:d(d([],D,!0),[b],!1),customAttributes:{_vajro_flow:u(u(u({},O),N),{_productQuantity:A,_freeQuantity:((null==N?void 0:N.freeQuantity)||0)+h})}}),r)):h&&(o=u(u({},o),((n={})[a]={variantId:a,productId:c,displayTextDetails:[b],lineItemHandle:v,customAttributes:{_vajro_flow:u(u(u({},O),N),{_productQuantity:A,_actualUnitPrice:Number(l),_freeQuantity:h,_productTargetId:i})}},n)))}))}})),o}(o,h,e);break;case"buyXGetY":e=function(t,r,o){var e=n(r),i=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"freeOfferTarget";return t.forEach((function(t,r){var n=t.getProductCount,a=t.getProducts,c=t.displayText;a.forEach((function(t){var r,a,u=t.variantId,d=t.productId,s=t.productPrice,v=e[u]||{},p=v.quantity,y=void 0===p?0:p,m=v.lineItemHandle,b=v.customAttributes,_=(void 0===b?{}:b)._vajro_flow,g=void 0===_?{}:_,h=("string"==typeof g?JSON.parse(g):l({},g))._freeQuantity,O=void 0===h?0:h,I=y-O>n?n:y-O,P=o[u],A=P||{},j=A.customAttributes,T=(void 0===j?{}:j)._vajro_flow,w=void 0===T?{}:T,N=A.displayTextDetails,U=void 0===N?[]:N;I&&P?o=l(l({},o),((r={})[u]=l(l({},P),{displayTextDetails:U.includes(c)?U:f(f([],U,!0),[c],!1),customAttributes:{_vajro_flow:l(l({},w),{_discountQuantity:I+((null==w?void 0:w._discountQuantity)||0),_productTargetId:i})}}),r)):I&&(o=l(l({},o),((a={})[u]={variantId:u,productId:d,lineItemHandle:m,displayTextDetails:[c],customAttributes:{_vajro_flow:l(l({},w),{_productQuantity:y-O,_actualUnitPrice:Number(s),_discountQuantity:I,_productTargetId:i})}},a)))}))})),o}(o,h,e);break;case"percentageDiscount":e=function(t,r,o){var e=n(r);return t.forEach((function(t,i){var n=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"percentageOffer".concat(i),a=t.discountValue,c=t.getOfferType,u=t.getProducts,d=t.getCollections,l=t.displayText,f=[];"products"===c?u.forEach((function(t){var r=t.variantId;e[r]&&(f=y(y([],f,!0),[e[r]],!1))})):"collections"===c?d.forEach((function(t){var o=t.collectionId,e=r.filter((function(t){return o===t.collectionId}));e.length>0&&(f=y(y([],f,!0),e,!0))})):f=y([],r,!0),f.forEach((function(t){var r,e=t.variantId,i=t.productId,c=t.lineItemHandle,u=t.unitPrice,d=t.quantity,f=void 0===d?0:d,s=t.customAttributes,v=(void 0===s?{}:s)._vajro_flow,y=void 0===v?{}:v,m="string"==typeof y?JSON.parse(y):p({},y),b=m._actualUnitPrice,_=void 0===b?u:b,g=m._freeQuantity,h=void 0===g?0:g,O=o[e]||{},I=O.customAttributes,P=(void 0===I?{}:I)._vajro_flow,A=void 0===P?{}:P,j=f?Number(f)-Number(h):0,T=_*(a/100),w=A._discountPrice,N=void 0===w?0:w,U=A._discountQuantity,D=void 0===U?0:U;T>N&&j>0&&(o=p(p({},o),((r={})[e]=p(p({},O),{variantId:e,productId:i,lineItemHandle:c,displayText:l,customAttributes:{_vajro_flow:p(p({},A),{_actualUnitPrice:Number(_),_discountPrice:T,_productQuantity:j,_discountQuantity:T===_?j:D,_offerPercenatage:a>=100?100:a,_percentageTargetId:n})}}),r)))}))})),o}(o,h,e);break;case"flatDiscount":e=function(t,r,o){var e=n(r),i=s({},o);function c(t,r,o,e,n){if(0!==t.length){var c=a(t),u=o/c*100,d=t.map((function(t){return s(s({},t),{customAttributes:{}})}));t.forEach((function(t){var a,c=t.variantId,l=t.productId,f=t.lineItemHandle,v=t.unitPrice,p=t.quantity,y=void 0===p?0:p,m=t.customAttributes,b=(void 0===m?{}:m)._vajro_flow,_=void 0===b?{}:b,g="string"==typeof _?JSON.parse(_):s({},_),h=g._actualUnitPrice,O=void 0===h?v:h,I=g._freeQuantity,P=void 0===I?0:I,A=i[c]||{},j=A.customAttributes,T=(void 0===j?{}:j)._vajro_flow,w=void 0===T?{}:T,N=y?Number(y)-Number(P):0,U=e?O*(u/100):o,D=w._discountQuantity,x=void 0===D?0:D;i=s(s({},i),((a={})[c]=s(s({},A),{variantId:c,productId:l,lineItemHandle:f,displayText:r,customAttributes:{_vajro_flow:s(s({},w),{_actualUnitPrice:Number(O),_productQuantity:N,_discountPrice:U>=O?O:U,_discountQuantity:U>=O?N:x,_offerPercenatage:u>=100?100:u,_amountTargetId:n,_flatDiscountDetails:{lineItems:d,splitFlatAmount:e,discountValue:o,displayText:r}})}}),a))}))}}return t.forEach((function(t,o){var n=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"amountOffer".concat(o),u=t.discountValue,d=t.getOfferType,l=t.getProducts,f=t.getCollections,p=t.splitFlatAmount,y=t.displayText,m=[];"products"===d?l.forEach((function(t){var r=t.variantId,o=e[r]||{},i=o.quantity,n=void 0===i?0:i,a=o.customAttributes,c=(void 0===a?{}:a)._vajro_flow,u=void 0===c?{}:c,d=("string"==typeof u?JSON.parse(u):s({},u))._freeQuantity,l=void 0===d?0:d;Number(n)-Number(l)>0&&(m=v(v([],m,!0),[e[r]],!1))})):"collections"===d?f.forEach((function(t){var o=t.collectionId,e=r.filter((function(t){var r=t.quantity,e=void 0===r?0:r,i=t.customAttributes,n=(void 0===i?{}:i)._vajro_flow,a=void 0===n?{}:n,c=("string"==typeof a?JSON.parse(a):s({},a))._freeQuantity,u=void 0===c?0:c;return o===t.collectionId&&Number(e)-Number(u)>0}));e.length>0&&(m=v(v([],m,!0),e,!0))})):m=r.filter((function(t){var r=t.quantity,o=void 0===r?0:r,e=t.customAttributes,i=(void 0===e?{}:e)._vajro_flow,n=void 0===i?{}:i,a=("string"==typeof n?JSON.parse(n):s({},n))._freeQuantity,c=void 0===a?0:a;return Number(o)-Number(c)>0}));var b=a(m),_=s({},i);m=m.filter((function(t){var r=t.variantId,o=t.unitPrice,e=t.customAttributes,i=(void 0===e?{}:e)._vajro_flow,n=void 0===i?{}:i,a=("string"==typeof n?JSON.parse(n):s({},n))._actualUnitPrice,d=void 0===a?o:a,l=(_[r]||{}).customAttributes,f=(void 0===l?{}:l)._vajro_flow,v=void 0===f?{}:f,y=p?d*(u/b):u,m=v._discountPrice,g=void 0===m?0:m,h=v._flatDiscountDetails,O=void 0===h?{}:h,I=v._amountTargetId,P=v.displayText,A=O.lineItems,j=void 0===A?[]:A,T=O.splitFlatAmount,w=void 0!==T&&T,N=O.discountValue,U=void 0===N?0:N;if(y>g){var D=j.filter((function(t){return t.variantId!==r}));w&&D.length>0&&c(D,P,U,w,I)}return y>g})),c(m,y,u,p,n)})),i}(o,h,e)}}));var i=[];Object.values(e).forEach((function(t){var r=t.variantId,o=t.displayTextDetails,n=void 0===o?[]:o,a=t.displayText,c=void 0===a?"":a,u=t.customAttributes;b(b([],n,!0),[c],!1).forEach((function(t){!i.includes(t)&&t&&(i=b(b([],i,!0),[t],!1))})),e[r]=m(m({},t),{customAttributes:u})})),_[r]={offerAppliedProducts:e,displayTextArray:i}}));var U=Object.entries(_).reduce((function(t,r){r[0];var e=r[1],i=t.discountPrice,n=e.offerAppliedProducts,a=e.displayTextArray,c=function(t){return t.reduce((function(t,r){var e=r.customAttributes,i=(void 0===e?{}:e)._vajro_flow,n=void 0===i?{}:i,a="string"==typeof n?JSON.parse(n):o({},n),c=a._actualUnitPrice,u=void 0===c?0:c,d=a._discountPrice,l=void 0===d?0:d,f=a._discountQuantity,s=void 0===f?0:f,v=a._freeQuantity,p=void 0===v?0:v;return t+(Number(u)*(Number(s)+Number(p))+Number(l))}),0)}(Object.values(n));return c>i?{discountPrice:c,offerAppliedDetails:n,displayTextArray:a}:t}),{discountPrice:0,offerAppliedDetails:{},displayTextArray:[]}),D=U.discountPrice,x=U.offerAppliedDetails,Q=function(t){if(0===t.length)return"";var r=t.map((function(t){return'<p style="text-align: center;font-size: 14px"><b>'.concat(t,"</b></p>")})).join("");return'<!DOCTYPE html>\n\t<html lang="en">\n\t\t<head>\n\t\t\t<meta charset="UTF-8" />\n\t\t\t<meta http-equiv="X-UA-Compatible" content="IE=edge" />\n\t\t\t<meta name="viewport" content="width=device-width,initial-scale=1.0" />\n\t\t</head>\n\t\t<body style="min-width: auto; min-height: auto">\n            '.concat(r,"\n\t\t</body>\n\t</html>")}(U.displayTextArray),C=Object.keys(w).reduce((function(t,r){var o;return x[r]?t:m(m({},t),((o={})[r]=w[r],o))}),{});return{discountPrice:D,offerAppliedDetails:x,offerRemovedDetails:C,displayTextHtml:Q}};vajroPlugin=r})();
//# sourceMappingURL=vajroPlugin.js.map
