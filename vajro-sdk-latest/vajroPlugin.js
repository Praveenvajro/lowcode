var vajroPlugin;(()=>{"use strict";var t={d:(r,e)=>{for(var o in e)t.o(e,o)&&!t.o(r,o)&&Object.defineProperty(r,o,{enumerable:!0,get:e[o]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};t.r(r),t.d(r,{flow:()=>g});var e=function(){return e=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},e.apply(this,arguments)},o=function(t,r,e){if(e||2===arguments.length)for(var o,i=0,n=r.length;i<n;i++)!o&&i in r||(o||(o=Array.prototype.slice.call(r,0,i)),o[i]=r[i]);return t.concat(o||Array.prototype.slice.call(r))},i=function(t){return t.reduce((function(t,r){var i,n,a=r.offerCategory;return t[a]?e(e({},t),((i={})[a]=o(o([],t[a],!0),[r],!1),i)):e(e({},t),((n={})[a]=[r],n))}),{automaticOffers:[],buyXGetY:[],percentageDiscount:[],flatDiscount:[]})},n=function(t){return t.reduce((function(t,r){return t[r.variantId]=r,t}),{})},a=function(t,r){var e={isHaveLineItemHandle:!1,productLineItemHandle:"tempHandle".concat(Math.floor(1e6*Math.random()))};return Object.entries(t).forEach((function(t){var o=t[0],i=t[1],n=e.isHaveLineItemHandle,a=i.variantId;n||r!==a||(e={isHaveLineItemHandle:!0,productLineItemHandle:o})})),e},u=function(t){return t.reduce((function(t,r){var o=r.originalUnitPrice,i=void 0===o?0:o,n=r.quantity,a=void 0===n?0:n,u=r.customAttributes,c=(void 0===u?{}:u)._vajro_flow,l=void 0===c?{}:c,d=("string"==typeof l?JSON.parse(l):e({},l))||{},f=d._discountQuantity,s=void 0===f?0:f,v=d._freeQuantity,p=void 0===v?0:v;return t+Number(i)*(a-(Number(p)+Number(s)))}),0)},c=function(t){return t.reduce((function(t,r){var o=r.quantity,i=void 0===o?0:o,n=r.customAttributes,a=(void 0===n?{}:n)._vajro_flow,u=void 0===a?{}:a,c=(("string"==typeof u?JSON.parse(u):e({},u))||{})._freeQuantity;return t+(i-(void 0===c?0:c))}),0)},l=function(){return l=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},l.apply(this,arguments)},d=function(t,r,e){if(e||2===arguments.length)for(var o,i=0,n=r.length;i<n;i++)!o&&i in r||(o||(o=Array.prototype.slice.call(r,0,i)),o[i]=r[i]);return t.concat(o||Array.prototype.slice.call(r))},f=function(){return f=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},f.apply(this,arguments)},s=function(t,r,e){if(e||2===arguments.length)for(var o,i=0,n=r.length;i<n;i++)!o&&i in r||(o||(o=Array.prototype.slice.call(r,0,i)),o[i]=r[i]);return t.concat(o||Array.prototype.slice.call(r))},v=function(){return v=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},v.apply(this,arguments)},p=function(t,r,e){if(e||2===arguments.length)for(var o,i=0,n=r.length;i<n;i++)!o&&i in r||(o||(o=Array.prototype.slice.call(r,0,i)),o[i]=r[i]);return t.concat(o||Array.prototype.slice.call(r))},y=function(){return y=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},y.apply(this,arguments)},m=function(t,r,e){if(e||2===arguments.length)for(var o,i=0,n=r.length;i<n;i++)!o&&i in r||(o||(o=Array.prototype.slice.call(r,0,i)),o[i]=r[i]);return t.concat(o||Array.prototype.slice.call(r))},b=function(){return b=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},b.apply(this,arguments)},_=function(t,r,e){if(e||2===arguments.length)for(var o,i=0,n=r.length;i<n;i++)!o&&i in r||(o||(o=Array.prototype.slice.call(r,0,i)),o[i]=r[i]);return t.concat(o||Array.prototype.slice.call(r))},g=function(t,r){var g={},I=t.cartLineItems.lineItems,h=void 0===I?[]:I,O=function(t,r){var e=[],i=[];return t.forEach((function(t){var a=n(r),l=t.cartType,d=t.cartValue,f=t.buyOfferType,s=t.buyProducts,v=t.buyCollections,p=(t.getOfferType,t.discountType,t.getProductCount,t.reccuringFreeProduct,t.getProducts,[]);if("products"===f)s.forEach((function(t){var r=t.variantId;a[r]&&(p=o(o([],p,!0),[a[r]],!1))}));else if("collections"===f){var y=r.filter((function(t){var r,e=(null===(r=null==t?void 0:t.collectionId)||void 0===r?void 0:r.split(","))||[];return v.some((function(t){var r=t.collectionId;return e.includes(r)}))}));y.length>0&&(p=o(o([],p,!0),y,!0))}else p=r;("amount"===l?u(p):c(p))>=d?e=o(o([],e,!0),[t],!1):i=o(o([],i,!0),[t],!1)})),{validConfigList:e,inValidConfigList:i}}(r,h).validConfigList,A=O.reduce((function(t,r,i){var n=t.combinedOfferConfig,a=t.nonCombinedOfferConfig,u=r.combinedOffer;return e(e({},t),u?{combinedOfferConfig:o(o([],n,!0),[e(e({},r),{index:i})],!1)}:{nonCombinedOfferConfig:o(o([],a,!0),[e(e({},r),{index:i})],!1)})}),{combinedOfferConfig:[],nonCombinedOfferConfig:[]}),j=A.combinedOfferConfig,P=void 0===j?[]:j,N=A.nonCombinedOfferConfig,T=void 0===N?[]:N,w=function(t){return t.reduce((function(t,r){var o,i=r.lineItemHandle,n=r.customAttributes,a=void 0===n?{}:n,u=a._vajro_flow,c=void 0===u?{}:u,l="string"==typeof c?JSON.parse(c):e({},c);return-1!==Object.keys(l).indexOf("_actualUnitPrice")?e(e({},t),((o={})[i]=e(e({},r),{customAttributes:e(e({},a),{_vajro_flow:l})}),o)):t}),{})}(h),U={};(null==P?void 0:P.length)>0&&(U.combinedOffer=i(P)),T.forEach((function(t,r){var e=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"offer".concat(r);U[e]=i([t])})),Object.entries(U).forEach((function(t){var r=t[0],e=t[1],o={};Object.entries(e).forEach((function(t){var r=t[0],e=t[1];if(0!==e.length)switch(r){case"automaticOffers":o=function(t,r,e){var o=n(r),i=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"freeOfferTarget";return t.forEach((function(t){var n=t.cartType,f=t.cartValue,s=t.buyOfferType,v=t.buyProducts,p=t.buyCollections,y=t.getProductCount,m=t.reccuringFreeProduct,b=t.getProducts,_=t.displayText,g=[];if("products"===s)v.forEach((function(t){var r=t.variantId;o[r]&&(g=d(d([],g,!0),[o[r]],!1))}));else if("collections"===s){var I=r.filter((function(t){var r,e=(null===(r=null==t?void 0:t.collectionId)||void 0===r?void 0:r.split(","))||[];return p.some((function(t){var r=t.collectionId;return e.includes(r)}))}));I.length>0&&(g=d(d([],g,!0),I,!0))}else g=r;var h="amount"===n?u(g):c(g);if(h>=Number(f)){var O=m?Math.floor(h/f)*y:Number(y);b.forEach((function(t){var r,n,u=t.variantId,c=t.productId,f=t.productPrice,s=a(e,u),v=s.isHaveLineItemHandle,p=s.productLineItemHandle,y=o[u]||{},m=y.lineItemHandle,b=y.quantity,g=void 0===b?0:b,I=y.customAttributes,h=void 0===I?{}:I;m&&(p=m);var A=v||m?e[p]:null,j=h._vajro_flow,P=void 0===j?{}:j,N="string"==typeof P?JSON.parse(P):l({},P),T=N._freeQuantity,w=void 0===T?0:T,U=g?Number(g)-Number(w):0,D=A||{},Q=D.customAttributes,x=(void 0===Q?{}:Q)._vajro_flow,H=void 0===x?{}:x,C=D.displayTextDetails,E=void 0===C?[]:C;O&&A?e=l(l({},e),((r={})[p]=l(l({},A),{displayTextDetails:E.includes(_)?E:d(d([],E,!0),[_],!1),customAttributes:{_vajro_flow:l(l(l({},N),H),{_productQuantity:U,_freeQuantity:Number((null==H?void 0:H._freeQuantity)||0)+O})}}),r)):O&&(e=l(l({},e),((n={})[p]={variantId:u,productId:c,displayTextDetails:[_],lineItemHandle:m,customAttributes:{_vajro_flow:l(l(l({},N),H),{_productQuantity:U,_actualUnitPrice:Number(f),_freeQuantity:O,_productTargetId:i,_variantId:u})}},n)))}))}})),e}(e,h,o);break;case"buyXGetY":o=function(t,r,e){var o=n(r),i=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"freeOfferTarget";return t.forEach((function(t,r){var n=t.getProductCount,u=t.getProducts,c=t.displayText;u.forEach((function(t){var r,u,l=t.variantId,d=t.productId,v=t.productPrice,p=a(e,l),y=p.isHaveLineItemHandle,m=p.productLineItemHandle,b=o[l]||{},_=b.quantity,g=void 0===_?0:_,I=b.lineItemHandle,h=b.customAttributes,O=(void 0===h?{}:h)._vajro_flow,A=void 0===O?{}:O,j=("string"==typeof A?JSON.parse(A):f({},A))._freeQuantity,P=void 0===j?0:j,N=g-P>n?n:g-P,T=y?e[m]:null,w=T||{},U=w.customAttributes,D=(void 0===U?{}:U)._vajro_flow,Q=void 0===D?{}:D,x=w.displayTextDetails,H=void 0===x?[]:x;N&&T?e=f(f({},e),((r={})[m]=f(f({},T),{displayTextDetails:H.includes(c)?H:s(s([],H,!0),[c],!1),customAttributes:{_vajro_flow:f(f({},Q),{_discountQuantity:N+((null==Q?void 0:Q._discountQuantity)||0),_productTargetId:i})}}),r)):N&&(e=f(f({},e),((u={})[m]={variantId:l,productId:d,lineItemHandle:I,displayTextDetails:[c],customAttributes:{_vajro_flow:f(f({},Q),{_productQuantity:g-P,_actualUnitPrice:Number(v),_discountQuantity:N,_productTargetId:i,_variantId:l})}},u)))}))})),e}(e,h,o);break;case"percentageDiscount":o=function(t,r,e){var o=n(r);return t.forEach((function(t,i){var n=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"percentageOffer".concat(i),a=t.discountValue,u=t.getOfferType,c=t.getProducts,l=t.getCollections,d=t.displayText,f=[];if("products"===u)c.forEach((function(t){var r=t.variantId;o[r]&&(f=m(m([],f,!0),[o[r]],!1))}));else if("collections"===u){var s=r.filter((function(t){var r,e=(null===(r=null==t?void 0:t.collectionId)||void 0===r?void 0:r.split(","))||[];return l.some((function(t){var r=t.collectionId;return e.includes(r)}))}));s.length>0&&(f=m(m([],f,!0),s,!0))}else f=m([],r,!0);f.forEach((function(t){var r,o=t.variantId,i=t.productId,u=t.lineItemHandle,c=t.originalUnitPrice,l=t.quantity,f=void 0===l?0:l,s=t.customAttributes,v=(void 0===s?{}:s)._vajro_flow,p=void 0===v?{}:v,m=("string"==typeof p?JSON.parse(p):y({},p))._freeQuantity,b=void 0===m?0:m,_=e[u]||{},g=_.customAttributes,I=(void 0===g?{}:g)._vajro_flow,h=void 0===I?{}:I,O=f?Number(f)-Number(b):0,A=Number(c)*(a/100),j=h._discountPrice,P=void 0===j?0:j,N=h._discountQuantity,T=void 0===N?0:N;A>P&&O>0&&(e=y(y({},e),((r={})[u]=y(y({},_),{variantId:o,productId:i,lineItemHandle:u,displayText:d,customAttributes:{_vajro_flow:y(y({},h),{_actualUnitPrice:Number(c),_discountPrice:A,_productQuantity:O,_discountQuantity:Number(A)===Number(c)?O:T,_offerPercenatage:a>=100?100:a,_percentageTargetId:n,_variantId:o})}}),r)))}))})),e}(e,h,o);break;case"flatDiscount":o=function(t,r,e){var o=n(r),i=v({},e);function a(t,r,e,o,n){if(0!==t.length){var a=u(t),c=e/a*100,l=t.map((function(t){return v(v({},t),{customAttributes:{}})}));t.forEach((function(t){var a,u=t.variantId,d=t.productId,f=t.lineItemHandle,s=t.originalUnitPrice,p=t.quantity,y=void 0===p?0:p,m=t.customAttributes,b=(void 0===m?{}:m)._vajro_flow,_=void 0===b?{}:b,g=("string"==typeof _?JSON.parse(_):v({},_))._freeQuantity,I=void 0===g?0:g,h=i[f]||{},O=h.customAttributes,A=(void 0===O?{}:O)._vajro_flow,j=void 0===A?{}:A,P=y?Number(y)-Number(I):0,N=o?Number(s)*(c/100):e,T=j._discountQuantity,w=void 0===T?0:T;i=v(v({},i),((a={})[f]=v(v({},h),{variantId:u,productId:d,lineItemHandle:f,displayText:r,customAttributes:{_vajro_flow:v(v({},j),{_actualUnitPrice:Number(s),_productQuantity:P,_discountPrice:N>=s?s:N,_discountQuantity:N>=s?P:w,_offerPercenatage:c>=100?100:c,_amountTargetId:n,_flatDiscountDetails:{lineItems:l,splitFlatAmount:o,discountValue:e,displayText:r},_variantId:u})}}),a))}))}}return t.forEach((function(t,e){var n=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"amountOffer".concat(e),c=t.discountValue,l=t.getOfferType,d=t.getProducts,f=t.getCollections,s=t.splitFlatAmount,y=t.displayText,m=[];if("products"===l)d.forEach((function(t){var r=t.variantId,e=o[r]||{},i=e.quantity,n=void 0===i?0:i,a=e.customAttributes,u=(void 0===a?{}:a)._vajro_flow,c=void 0===u?{}:u,l=("string"==typeof c?JSON.parse(c):v({},c))._freeQuantity,d=void 0===l?0:l;Number(n)-Number(d)>0&&(m=p(p([],m,!0),[o[r]],!1))}));else if("collections"===l){var b=r.filter((function(t){var r,e=t.quantity,o=void 0===e?0:e,i=t.customAttributes,n=(void 0===i?{}:i)._vajro_flow,a=void 0===n?{}:n,u=(null===(r=null==t?void 0:t.collectionId)||void 0===r?void 0:r.split(","))||[],c=f.some((function(t){var r=t.collectionId;return u.includes(r)})),l=("string"==typeof a?JSON.parse(a):v({},a))._freeQuantity,d=void 0===l?0:l;return c&&Number(o)-Number(d)>0}));b.length>0&&(m=p(p([],m,!0),b,!0))}else m=r.filter((function(t){var r=t.quantity,e=void 0===r?0:r,o=t.customAttributes,i=(void 0===o?{}:o)._vajro_flow,n=void 0===i?{}:i,a=("string"==typeof n?JSON.parse(n):v({},n))._freeQuantity,u=void 0===a?0:a;return Number(e)-Number(u)>0}));var _=u(m),g=v({},i);m=m.filter((function(t){var r=t.variantId,e=t.lineItemHandle,o=t.originalUnitPrice,i=t.customAttributes,n=(void 0===i?{}:i)._vajro_flow,u=void 0===n?{}:n,l=("string"==typeof u?JSON.parse(u):v({},u),(g[e]||{}).customAttributes),d=(void 0===l?{}:l)._vajro_flow,f=void 0===d?{}:d,p=s?Number(o)*(c/_):c,y=f._discountPrice,m=void 0===y?0:y,b=f._flatDiscountDetails,I=void 0===b?{}:b,h=f._amountTargetId,O=f.displayText,A=I.lineItems,j=void 0===A?[]:A,P=I.splitFlatAmount,N=void 0!==P&&P,T=I.discountValue,w=void 0===T?0:T;if(p>m){var U=j.filter((function(t){return t.variantId!==r}));N&&U.length>0&&a(U,O,w,N,h)}return p>m})),a(m,y,c,s,n)})),i}(e,h,o)}}));var i=[];Object.values(o).forEach((function(t){var r=t.displayTextDetails,e=void 0===r?[]:r,o=t.displayText,n=void 0===o?"":o;_(_([],e,!0),[n],!1).forEach((function(t){!i.includes(t)&&t&&(i=_(_([],i,!0),[t],!1))}))})),g[r]={offerAppliedProducts:o,displayTextArray:i}}));var D=Object.entries(g).reduce((function(t,r){r[0];var o=r[1],i=t.discountPrice,n=o.offerAppliedProducts,a=o.displayTextArray,u=function(t){return t.reduce((function(t,r){var o=r.customAttributes,i=(void 0===o?{}:o)._vajro_flow,n=void 0===i?{}:i,a="string"==typeof n?JSON.parse(n):e({},n),u=a._actualUnitPrice,c=void 0===u?0:u,l=a._discountPrice,d=void 0===l?0:l,f=a._discountQuantity,s=void 0===f?0:f,v=a._freeQuantity,p=void 0===v?0:v,y=a._productQuantity,m=void 0===y?0:y;return t+(Number(c)*(Number(s)+Number(p))+Number(d)*Number(m))}),0)}(Object.values(n));return u>=i?{discountPrice:u,offerAppliedDetails:n,displayTextArray:a}:t}),{discountPrice:0,offerAppliedDetails:{},displayTextArray:[]}),Q=D.discountPrice,x=D.offerAppliedDetails,H=function(t){if(0===t.length)return"";var r=t.map((function(t){return'<p style="text-align: center;font-size: 14px"><b>'.concat(t,"</b></p>")})).join("");return'<!DOCTYPE html>\n\t<html lang="en">\n\t\t<head>\n\t\t\t<meta charset="UTF-8" />\n\t\t\t<meta http-equiv="X-UA-Compatible" content="IE=edge" />\n\t\t\t<meta name="viewport" content="width=device-width,initial-scale=1.0" />\n\t\t</head>\n\t\t<body style="min-width: auto; min-height: auto">\n            '.concat(r,"\n\t\t</body>\n\t</html>")}(D.displayTextArray),C=Object.keys(w).reduce((function(t,r){var e;return x[r]?t:b(b({},t),((e={})[r]=w[r],e))}),{});return{discountPrice:Q,offerAppliedDetails:x,offerRemovedDetails:C,displayTextHtml:H}};vajroPlugin=r})();
//# sourceMappingURL=vajroPlugin.js.map
