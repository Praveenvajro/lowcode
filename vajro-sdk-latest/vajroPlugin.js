var vajroPlugin;(()=>{"use strict";var t={d:(r,o)=>{for(var e in o)t.o(o,e)&&!t.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:o[e]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};t.r(r),t.d(r,{flow:()=>_});var o=function(){return o=Object.assign||function(t){for(var r,o=1,e=arguments.length;o<e;o++)for(var i in r=arguments[o])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},o.apply(this,arguments)},e=function(t,r,o){if(o||2===arguments.length)for(var e,i=0,n=r.length;i<n;i++)!e&&i in r||(e||(e=Array.prototype.slice.call(r,0,i)),e[i]=r[i]);return t.concat(e||Array.prototype.slice.call(r))},i=function(t){return t.reduce((function(t,r){var i,n,a=r.offerCategory;return t[a]?o(o({},t),((i={})[a]=e(e([],t[a],!0),[r],!1),i)):o(o({},t),((n={})[a]=[r],n))}),{automaticOffers:[],buyXGetY:[],percentageDiscount:[],flatDiscount:[]})},n=function(t){return t.reduce((function(t,r){return t[r.variantId]=r,t}),{})},a=function(t){return t.reduce((function(t,r){var o=r.unitPrice,e=void 0===o?0:o,i=r.quantity,n=void 0===i?0:i,a=r.customAttributes,c=void 0===a?{}:a,u=(null==c?void 0:c._vajro_flow)||{},l=u._actualUnitPrice,d=void 0===l?e:l,f=u._discountQuantity,v=void 0===f?0:f,s=u._freeQuantity;return t+d*(n-(Number(void 0===s?0:s)+Number(v)))}),0)},c=function(t){return t.reduce((function(t,r){var o=r.quantity,e=void 0===o?0:o,i=r.freeQuantity;return t+(e-(void 0===i?0:i))}),0)},u=function(){return u=Object.assign||function(t){for(var r,o=1,e=arguments.length;o<e;o++)for(var i in r=arguments[o])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},u.apply(this,arguments)},l=function(t,r,o){if(o||2===arguments.length)for(var e,i=0,n=r.length;i<n;i++)!e&&i in r||(e||(e=Array.prototype.slice.call(r,0,i)),e[i]=r[i]);return t.concat(e||Array.prototype.slice.call(r))},d=function(){return d=Object.assign||function(t){for(var r,o=1,e=arguments.length;o<e;o++)for(var i in r=arguments[o])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},d.apply(this,arguments)},f=function(t,r,o){if(o||2===arguments.length)for(var e,i=0,n=r.length;i<n;i++)!e&&i in r||(e||(e=Array.prototype.slice.call(r,0,i)),e[i]=r[i]);return t.concat(e||Array.prototype.slice.call(r))},v=function(){return v=Object.assign||function(t){for(var r,o=1,e=arguments.length;o<e;o++)for(var i in r=arguments[o])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},v.apply(this,arguments)},s=function(t,r,o){if(o||2===arguments.length)for(var e,i=0,n=r.length;i<n;i++)!e&&i in r||(e||(e=Array.prototype.slice.call(r,0,i)),e[i]=r[i]);return t.concat(e||Array.prototype.slice.call(r))},p=function(){return p=Object.assign||function(t){for(var r,o=1,e=arguments.length;o<e;o++)for(var i in r=arguments[o])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},p.apply(this,arguments)},y=function(t,r,o){if(o||2===arguments.length)for(var e,i=0,n=r.length;i<n;i++)!e&&i in r||(e||(e=Array.prototype.slice.call(r,0,i)),e[i]=r[i]);return t.concat(e||Array.prototype.slice.call(r))},m=function(){return m=Object.assign||function(t){for(var r,o=1,e=arguments.length;o<e;o++)for(var i in r=arguments[o])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},m.apply(this,arguments)},b=function(t,r,o){if(o||2===arguments.length)for(var e,i=0,n=r.length;i<n;i++)!e&&i in r||(e||(e=Array.prototype.slice.call(r,0,i)),e[i]=r[i]);return t.concat(e||Array.prototype.slice.call(r))},_=function(t,r){var _={},g=t.cartLineItems.lineItems,h=void 0===g?[]:g,I=function(t,r){var o=[],i=[];return t.forEach((function(t){var u=n(r),l=t.cartType,d=t.cartValue,f=t.buyOfferType,v=t.buyProducts,s=t.buyCollections,p=(t.getOfferType,t.discountType,t.getProductCount,t.reccuringFreeProduct,t.getProducts,[]);"products"===f?v.forEach((function(t){var r=t.variantId;u[r]&&(p=e(e([],p,!0),[u[r]],!1))})):"collections"===f?s.forEach((function(t){var o=t.collectionId,i=r.filter((function(t){return o===t.collectionId}));i.length>0&&(p=e(e([],p,!0),i,!0))})):p=r,("amount"===l?a(p):c(p))>=d?o=e(e([],o,!0),[t],!1):i=e(e([],i,!0),[t],!1)})),{validConfigList:o,inValidConfigList:i}}(r,h).validConfigList,P=I.reduce((function(t,r,i){var n=t.combinedOfferConfig,a=t.nonCombinedOfferConfig,c=r.combinedOffer;return o(o({},t),c?{combinedOfferConfig:e(e([],n,!0),[o(o({},r),{index:i})],!1)}:{nonCombinedOfferConfig:e(e([],a,!0),[o(o({},r),{index:i})],!1)})}),{combinedOfferConfig:[],nonCombinedOfferConfig:[]}),O=P.combinedOfferConfig,A=void 0===O?[]:O,j=P.nonCombinedOfferConfig,T=void 0===j?[]:j,w=function(t){return t.reduce((function(t,r){var e,i=r.variantId,n=r.customAttributes,a=(void 0===n?{}:n)._vajro_flow,c=void 0===a?{}:a;return-1!==Object.keys(c).indexOf("_actualUnitPrice")?o(o({},t),((e={})[i]=r,e)):t}),{})}(h),U={};(null==A?void 0:A.length)>0&&(U.combinedOffer=i(A)),T.forEach((function(t,r){var o=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"offer".concat(r);U[o]=i([t])})),Object.entries(U).forEach((function(t){var r=t[0],o=t[1],e={};Object.entries(o).forEach((function(t){var r=t[0],o=t[1];if(0!==o.length)switch(r){case"automaticOffers":e=function(t,r,o){var e=n(r),i=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"freeOfferTarget";return t.forEach((function(t){var n=t.cartType,d=t.cartValue,f=t.buyOfferType,v=t.buyProducts,s=t.buyCollections,p=t.getProductCount,y=t.reccuringFreeProduct,m=t.getProducts,b=t.displayText,_=[];"products"===f?v.forEach((function(t){var r=t.variantId;e[r]&&(_=l(l([],_,!0),[e[r]],!1))})):"collections"===f?s.forEach((function(t){var o=t.collectionId,e=r.filter((function(t){return o===t.collectionId}));e.length>0&&(_=l(l([],_,!0),e,!0))})):_=r;var g="amount"===n?a(_):c(_);if(g>=d){var h=y?Math.floor(g/d)*p:p;m.forEach((function(t){var r,n,a=t.variantId,c=t.productId,d=t.productPrice,f=o[a],v=e[a]||{},s=v.lineItemHandle,p=v.quantity,y=void 0===p?0:p,m=v.customAttributes._vajro_flow,_=void 0===m?{}:m,g=_._freeQuantity,I=void 0===g?0:g,P=y?Number(y)-Number(I):0,O=f||{},A=O.customAttributes,j=(void 0===A?{}:A)._vajro_flow,T=void 0===j?{}:j,w=O.displayTextDetails,U=void 0===w?[]:w;h&&f?o=u(u({},o),((r={})[a]=u(u({},f),{displayTextDetails:U.includes(b)?U:l(l([],U,!0),[b],!1),customAttributes:{_vajro_flow:u(u(u({},_),T),{_productQuantity:P,_freeQuantity:((null==T?void 0:T.freeQuantity)||0)+h})}}),r)):h&&(o=u(u({},o),((n={})[a]={variantId:a,productId:c,displayTextDetails:[b],lineItemHandle:s,customAttributes:u(u(u({},_),T),{_productQuantity:P,_actualUnitPrice:Number(d),_freeQuantity:h,_productTargetId:i})},n)))}))}})),o}(o,h,e);break;case"buyXGetY":e=function(t,r,o){var e=n(r),i=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"freeOfferTarget";return t.forEach((function(t,r){var n=t.getProductCount,a=t.getProducts,c=t.displayText;a.forEach((function(t){var r,a,u=t.variantId,l=t.productId,v=t.productPrice,s=e[u]||{},p=s.quantity,y=void 0===p?0:p,m=s.freeQuantity,b=void 0===m?0:m,_=s.lineItemHandle,g=y-b>n?n:y-b,h=o[u],I=h||{},P=I.customAttributes,O=(void 0===P?{}:P)._vajro_flow,A=void 0===O?{}:O,j=I.displayTextDetails,T=void 0===j?[]:j;g&&h?o=d(d({},o),((r={})[u]=d(d({},h),{displayTextDetails:T.includes(c)?T:f(f([],T,!0),[c],!1),customAttributes:{_vajro_flow:d(d({},A),{_discountQuantity:g+((null==A?void 0:A._discountQuantity)||0),_productTargetId:i})}}),r)):g&&(o=d(d({},o),((a={})[u]={variantId:u,productId:l,lineItemHandle:_,displayTextDetails:[c],customAttributes:{_vajro_flow:d(d({},A),{_productQuantity:y-b,_actualUnitPrice:Number(v),_discountQuantity:g,_productTargetId:i})}},a)))}))})),o}(o,h,e);break;case"percentageDiscount":e=function(t,r,o){var e=n(r);return t.forEach((function(t,i){var n=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"percentageOffer".concat(i),a=t.discountValue,c=t.getOfferType,u=t.getProducts,l=t.getCollections,d=t.displayText,f=[];"products"===c?u.forEach((function(t){var r=t.variantId;e[r]&&(f=y(y([],f,!0),[e[r]],!1))})):"collections"===c?l.forEach((function(t){var o=t.collectionId,e=r.filter((function(t){return o===t.collectionId}));e.length>0&&(f=y(y([],f,!0),e,!0))})):f=y([],r,!0),f.forEach((function(t){var r,e=t.variantId,i=t.productId,c=t.lineItemHandle,u=t.unitPrice,l=t.quantity,f=void 0===l?0:l,v=t.customAttributes,s=(void 0===v?{}:v)._vajro_flow,y=void 0===s?{}:s,m=y._actualUnitPrice,b=void 0===m?u:m,_=y._freeQuantity,g=void 0===_?0:_,h=o[e]||{},I=h.customAttributes,P=(void 0===I?{}:I)._vajro_flow,O=void 0===P?{}:P,A=f?Number(f)-Number(g):0,j=b*(a/100),T=O._discountPrice,w=void 0===T?0:T,U=O._discountQuantity,D=void 0===U?0:U;j>w&&A>0&&(o=p(p({},o),((r={})[e]=p(p({},h),{variantId:e,productId:i,lineItemHandle:c,displayText:d,customAttributes:{_vajro_flow:p(p({},O),{_actualUnitPrice:Number(b),_discountPrice:j,_productQuantity:A,_discountQuantity:j===b?A:D,_offerPercenatage:a>=100?100:a,_percentageTargetId:n})}}),r)))}))})),o}(o,h,e);break;case"flatDiscount":e=function(t,r,o){var e=n(r),i=v({},o);function c(t,r,o,e,n){if(0!==t.length){var c=a(t),u=o/c*100;t.forEach((function(a){var c,l=a.variantId,d=a.productId,f=a.lineItemHandle,s=a.unitPrice,p=a.quantity,y=void 0===p?0:p,m=a.customAttributes,b=(void 0===m?{}:m)._vajro_flow,_=void 0===b?{}:b,g=_._actualUnitPrice,h=void 0===g?s:g,I=_._freeQuantity,P=void 0===I?0:I,O=i[l]||{},A=O.customAttributes,j=(void 0===A?{}:A)._vajro_flow,T=void 0===j?{}:j,w=y?Number(y)-Number(P):0,U=e?h*(u/100):o,D=T._discountQuantity,x=void 0===D?0:D;i=v(v({},i),((c={})[l]=v(v({},O),{variantId:l,productId:d,lineItemHandle:f,displayText:r,customAttributes:{_vajro_flow:v(v({},T),{_actualUnitPrice:Number(h),_productQuantity:w,_discountPrice:U>=h?h:U,_discountQuantity:U>=h?w:x,_offerPercenatage:u>=100?100:u,_amountTargetId:n,_flatDiscountDetails:{lineItems:t,splitFlatAmount:e,discountValue:o,displayText:r}})}}),c))}))}}return t.forEach((function(t,o){var n=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"amountOffer".concat(o),u=t.discountValue,l=t.getOfferType,d=t.getProducts,f=t.getCollections,p=t.splitFlatAmount,y=t.displayText,m=[];"products"===l?d.forEach((function(t){var r=t.variantId,o=e[r]||{},i=o.quantity,n=void 0===i?0:i,a=o.customAttributes,c=(void 0===a?{}:a)._vajro_flow,u=(void 0===c?{}:c)._freeQuantity,l=void 0===u?0:u;Number(n)-Number(l)>0&&(m=s(s([],m,!0),[e[r]],!1))})):"collections"===l?f.forEach((function(t){var o=t.collectionId,e=r.filter((function(t){var r=t.quantity,e=void 0===r?0:r,i=t.customAttributes,n=(void 0===i?{}:i)._vajro_flow,a=(void 0===n?{}:n)._freeQuantity,c=void 0===a?0:a;return o===t.collectionId&&Number(e)-Number(c)>0}));e.length>0&&(m=s(s([],m,!0),e,!0))})):m=r.filter((function(t){var r=t.quantity,o=void 0===r?0:r,e=t.customAttributes,i=(void 0===e?{}:e)._vajro_flow,n=(void 0===i?{}:i)._freeQuantity,a=void 0===n?0:n;return Number(o)-Number(a)>0}));var b=a(m),_=v({},i);m=m.filter((function(t){var r=t.variantId,o=t.unitPrice,e=t.customAttributes,i=(void 0===e?{}:e)._vajro_flow,n=(void 0===i?{}:i)._actualUnitPrice,a=void 0===n?o:n,l=(_[r]||{}).customAttributes,d=(void 0===l?{}:l)._vajro_flow,f=void 0===d?{}:d,v=p?a*(u/b):u,s=f._discountPrice,y=void 0===s?0:s,m=f._flatDiscountDetails,g=void 0===m?{}:m,h=f._amountTargetId,I=f.displayText,P=g.lineItems,O=void 0===P?[]:P,A=g.splitFlatAmount,j=void 0!==A&&A,T=g.discountValue,w=void 0===T?0:T;if(v>y){var U=O.filter((function(t){return t.variantId!==r}));j&&U.length>0&&c(U,I,w,j,h)}return v>y})),c(m,y,u,p,n)})),i}(o,h,e)}}));var i=[];Object.values(e).forEach((function(t){var r=t.variantId,o=t.displayTextDetails,n=void 0===o?[]:o,a=t.displayText,c=void 0===a?"":a,u=t.customAttributes;b(b([],n,!0),[c],!1).forEach((function(t){!i.includes(t)&&t&&(i=b(b([],i,!0),[t],!1))})),e[r]=m(m({},t),{customAttributes:u})})),_[r]={offerAppliedProducts:e,displayTextArray:i}}));var D=Object.entries(_).reduce((function(t,r){r[0];var o=r[1],e=t.discountPrice,i=o.offerAppliedProducts,n=o.displayTextArray,a=function(t){return t.reduce((function(t,r){var o=r.customAttributes,e=void 0===o?{}:o,i=(null==e?void 0:e._vajro_flow)||{},n=i._actualUnitPrice,a=void 0===n?0:n,c=i._discountPrice,u=void 0===c?0:c,l=i._discountQuantity,d=void 0===l?0:l,f=i._freeQuantity,v=void 0===f?0:f;return t+(Number(a)*(Number(d)+Number(v))+Number(u))}),0)}(Object.values(i));return a>e?{discountPrice:a,offerAppliedDetails:i,displayTextArray:n}:t}),{discountPrice:0,offerAppliedDetails:{},displayTextArray:[]}),x=D.discountPrice,Q=D.offerAppliedDetails,C=function(t){if(0===t.length)return"";var r=t.map((function(t){return'<p style="text-align: center;font-size: 14px"><b>'.concat(t,"</b></p>")})).join("");return'<!DOCTYPE html>\n\t<html lang="en">\n\t\t<head>\n\t\t\t<meta charset="UTF-8" />\n\t\t\t<meta http-equiv="X-UA-Compatible" content="IE=edge" />\n\t\t\t<meta name="viewport" content="width=device-width,initial-scale=1.0" />\n\t\t</head>\n\t\t<body style="min-width: auto; min-height: auto">\n            '.concat(r,"\n\t\t</body>\n\t</html>")}(D.displayTextArray),E=Object.keys(w).reduce((function(t,r){var o;return Q[r]?t:m(m({},t),((o={})[r]=w[r],o))}),{});return{discountPrice:x,offerAppliedDetails:Q,offerRemovedDetails:E,displayTextHtml:C}};vajroPlugin=r})();
//# sourceMappingURL=vajroPlugin.js.map
