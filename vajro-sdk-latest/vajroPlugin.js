var vajroPlugin;(()=>{"use strict";var t={d:(r,e)=>{for(var o in e)t.o(e,o)&&!t.o(r,o)&&Object.defineProperty(r,o,{enumerable:!0,get:e[o]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};t.r(r),t.d(r,{flow:()=>_});var e=function(){return e=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},e.apply(this,arguments)},o=function(t,r,e){if(e||2===arguments.length)for(var o,i=0,n=r.length;i<n;i++)!o&&i in r||(o||(o=Array.prototype.slice.call(r,0,i)),o[i]=r[i]);return t.concat(o||Array.prototype.slice.call(r))},i=function(t){return t.reduce((function(t,r){var i,n,a=r.offerCategory;return t[a]?e(e({},t),((i={})[a]=o(o([],t[a],!0),[r],!1),i)):e(e({},t),((n={})[a]=[r],n))}),{automaticOffers:[],buyXGetY:[],percentageDiscount:[],flatDiscount:[]})},n=function(t){return t.reduce((function(t,r){return t[r.variantId]=r,t}),{})},a=function(t){return t.reduce((function(t,r){var o=r.unitPrice,i=void 0===o?0:o,n=r.quantity,a=void 0===n?0:n,c=r.customAttributes,u=(void 0===c?{}:c)._vajro_flow,l=void 0===u?{}:u,d=("string"==typeof l?JSON.parse(l):e({},l))||{},f=d._actualUnitPrice,s=void 0===f?i:f,v=d._discountQuantity,p=void 0===v?0:v,y=d._freeQuantity;return t+s*(a-(Number(void 0===y?0:y)+Number(p)))}),0)},c=function(t){return t.reduce((function(t,r){var e=r.quantity,o=void 0===e?0:e,i=r.freeQuantity;return t+(o-(void 0===i?0:i))}),0)},u=function(){return u=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},u.apply(this,arguments)},l=function(t,r,e){if(e||2===arguments.length)for(var o,i=0,n=r.length;i<n;i++)!o&&i in r||(o||(o=Array.prototype.slice.call(r,0,i)),o[i]=r[i]);return t.concat(o||Array.prototype.slice.call(r))},d=function(){return d=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},d.apply(this,arguments)},f=function(t,r,e){if(e||2===arguments.length)for(var o,i=0,n=r.length;i<n;i++)!o&&i in r||(o||(o=Array.prototype.slice.call(r,0,i)),o[i]=r[i]);return t.concat(o||Array.prototype.slice.call(r))},s=function(){return s=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},s.apply(this,arguments)},v=function(t,r,e){if(e||2===arguments.length)for(var o,i=0,n=r.length;i<n;i++)!o&&i in r||(o||(o=Array.prototype.slice.call(r,0,i)),o[i]=r[i]);return t.concat(o||Array.prototype.slice.call(r))},p=function(){return p=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},p.apply(this,arguments)},y=function(t,r,e){if(e||2===arguments.length)for(var o,i=0,n=r.length;i<n;i++)!o&&i in r||(o||(o=Array.prototype.slice.call(r,0,i)),o[i]=r[i]);return t.concat(o||Array.prototype.slice.call(r))},m=function(){return m=Object.assign||function(t){for(var r,e=1,o=arguments.length;e<o;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},m.apply(this,arguments)},b=function(t,r,e){if(e||2===arguments.length)for(var o,i=0,n=r.length;i<n;i++)!o&&i in r||(o||(o=Array.prototype.slice.call(r,0,i)),o[i]=r[i]);return t.concat(o||Array.prototype.slice.call(r))},_=function(t,r){var _={},g=t.cartLineItems.lineItems,h=void 0===g?[]:g,O=function(t,r){var e=[],i=[];return t.forEach((function(t){var u=n(r),l=t.cartType,d=t.cartValue,f=t.buyOfferType,s=t.buyProducts,v=t.buyCollections,p=(t.getOfferType,t.discountType,t.getProductCount,t.reccuringFreeProduct,t.getProducts,[]);if("products"===f)s.forEach((function(t){var r=t.variantId;u[r]&&(p=o(o([],p,!0),[u[r]],!1))}));else if("collections"===f){var y=r.filter((function(t){var r,e=(null===(r=null==t?void 0:t.collectionId)||void 0===r?void 0:r.split(","))||[];return v.some((function(t){var r=t.collectionId;return e.includes(r)}))}));y.length>0&&(p=o(o([],p,!0),y,!0))}else p=r;("amount"===l?a(p):c(p))>=d?e=o(o([],e,!0),[t],!1):i=o(o([],i,!0),[t],!1)})),{validConfigList:e,inValidConfigList:i}}(r,h).validConfigList,I=O.reduce((function(t,r,i){var n=t.combinedOfferConfig,a=t.nonCombinedOfferConfig,c=r.combinedOffer;return e(e({},t),c?{combinedOfferConfig:o(o([],n,!0),[e(e({},r),{index:i})],!1)}:{nonCombinedOfferConfig:o(o([],a,!0),[e(e({},r),{index:i})],!1)})}),{combinedOfferConfig:[],nonCombinedOfferConfig:[]}),P=I.combinedOfferConfig,A=void 0===P?[]:P,j=I.nonCombinedOfferConfig,T=void 0===j?[]:j,w=function(t){return t.reduce((function(t,r){var o,i=r.variantId,n=r.customAttributes,a=void 0===n?{}:n,c=a._vajro_flow,u=void 0===c?{}:c,l="string"==typeof u?JSON.parse(u):e({},u);return-1!==Object.keys(l).indexOf("_actualUnitPrice")?e(e({},t),((o={})[i]=e(e({},r),{customAttributes:e(e({},a),{_vajro_flow:l})}),o)):t}),{})}(h),N={};(null==A?void 0:A.length)>0&&(N.combinedOffer=i(A)),T.forEach((function(t,r){var e=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"offer".concat(r);N[e]=i([t])})),Object.entries(N).forEach((function(t){var r=t[0],e=t[1],o={};Object.entries(e).forEach((function(t){var r=t[0],e=t[1];if(0!==e.length)switch(r){case"automaticOffers":o=function(t,r,e){var o=n(r),i=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"freeOfferTarget";return t.forEach((function(t){var n=t.cartType,d=t.cartValue,f=t.buyOfferType,s=t.buyProducts,v=t.buyCollections,p=t.getProductCount,y=t.reccuringFreeProduct,m=t.getProducts,b=t.displayText,_=[];if("products"===f)s.forEach((function(t){var r=t.variantId;o[r]&&(_=l(l([],_,!0),[o[r]],!1))}));else if("collections"===f){var g=r.filter((function(t){var r,e=(null===(r=null==t?void 0:t.collectionId)||void 0===r?void 0:r.split(","))||[];return v.some((function(t){var r=t.collectionId;return e.includes(r)}))}));g.length>0&&(_=l(l([],_,!0),g,!0))}else _=r;var h="amount"===n?a(_):c(_);if(h>=d){var O=y?Math.floor(h/d)*p:p;m.forEach((function(t){var r,n,a=t.variantId,c=t.productId,d=t.productPrice,f=e[a],s=o[a]||{},v=s.lineItemHandle,p=s.quantity,y=void 0===p?0:p,m=s.customAttributes,_=(void 0===m?{}:m)._vajro_flow,g=void 0===_?{}:_,h="string"==typeof g?JSON.parse(g):u({},g),I=h._freeQuantity,P=void 0===I?0:I,A=y?Number(y)-Number(P):0,j=f||{},T=j.customAttributes,w=(void 0===T?{}:T)._vajro_flow,N=void 0===w?{}:w,U=j.displayTextDetails,D=void 0===U?[]:U;O&&f?e=u(u({},e),((r={})[a]=u(u({},f),{displayTextDetails:D.includes(b)?D:l(l([],D,!0),[b],!1),customAttributes:{_vajro_flow:u(u(u({},h),N),{_productQuantity:A,_freeQuantity:((null==N?void 0:N.freeQuantity)||0)+O})}}),r)):O&&(e=u(u({},e),((n={})[a]={variantId:a,productId:c,displayTextDetails:[b],lineItemHandle:v,customAttributes:{_vajro_flow:u(u(u({},h),N),{_productQuantity:A,_actualUnitPrice:Number(d),_freeQuantity:O,_productTargetId:i})}},n)))}))}})),e}(e,h,o);break;case"buyXGetY":o=function(t,r,e){var o=n(r),i=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"freeOfferTarget";return t.forEach((function(t,r){var n=t.getProductCount,a=t.getProducts,c=t.displayText;a.forEach((function(t){var r,a,u=t.variantId,l=t.productId,s=t.productPrice,v=o[u]||{},p=v.quantity,y=void 0===p?0:p,m=v.lineItemHandle,b=v.customAttributes,_=(void 0===b?{}:b)._vajro_flow,g=void 0===_?{}:_,h=("string"==typeof g?JSON.parse(g):d({},g))._freeQuantity,O=void 0===h?0:h,I=y-O>n?n:y-O,P=e[u],A=P||{},j=A.customAttributes,T=(void 0===j?{}:j)._vajro_flow,w=void 0===T?{}:T,N=A.displayTextDetails,U=void 0===N?[]:N;I&&P?e=d(d({},e),((r={})[u]=d(d({},P),{displayTextDetails:U.includes(c)?U:f(f([],U,!0),[c],!1),customAttributes:{_vajro_flow:d(d({},w),{_discountQuantity:I+((null==w?void 0:w._discountQuantity)||0),_productTargetId:i})}}),r)):I&&(e=d(d({},e),((a={})[u]={variantId:u,productId:l,lineItemHandle:m,displayTextDetails:[c],customAttributes:{_vajro_flow:d(d({},w),{_productQuantity:y-O,_actualUnitPrice:Number(s),_discountQuantity:I,_productTargetId:i})}},a)))}))})),e}(e,h,o);break;case"percentageDiscount":o=function(t,r,e){var o=n(r);return t.forEach((function(t,i){var n=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"percentageOffer".concat(i),a=t.discountValue,c=t.getOfferType,u=t.getProducts,l=t.getCollections,d=t.displayText,f=[];if("products"===c)u.forEach((function(t){var r=t.variantId;o[r]&&(f=y(y([],f,!0),[o[r]],!1))}));else if("collections"===c){var s=r.filter((function(t){var r,e=(null===(r=null==t?void 0:t.collectionId)||void 0===r?void 0:r.split(","))||[];return l.some((function(t){var r=t.collectionId;return e.includes(r)}))}));s.length>0&&(f=y(y([],f,!0),s,!0))}else f=y([],r,!0);f.forEach((function(t){var r,o=t.variantId,i=t.productId,c=t.lineItemHandle,u=t.unitPrice,l=t.quantity,f=void 0===l?0:l,s=t.customAttributes,v=(void 0===s?{}:s)._vajro_flow,y=void 0===v?{}:v,m="string"==typeof y?JSON.parse(y):p({},y),b=m._actualUnitPrice,_=void 0===b?u:b,g=m._freeQuantity,h=void 0===g?0:g,O=e[o]||{},I=O.customAttributes,P=(void 0===I?{}:I)._vajro_flow,A=void 0===P?{}:P,j=f?Number(f)-Number(h):0,T=_*(a/100),w=A._discountPrice,N=void 0===w?0:w,U=A._discountQuantity,D=void 0===U?0:U;T>N&&j>0&&(e=p(p({},e),((r={})[o]=p(p({},O),{variantId:o,productId:i,lineItemHandle:c,displayText:d,customAttributes:{_vajro_flow:p(p({},A),{_actualUnitPrice:Number(_),_discountPrice:T,_productQuantity:j,_discountQuantity:T===_?j:D,_offerPercenatage:a>=100?100:a,_percentageTargetId:n})}}),r)))}))})),e}(e,h,o);break;case"flatDiscount":o=function(t,r,e){var o=n(r),i=s({},e);function c(t,r,e,o,n){if(0!==t.length){var c=a(t),u=e/c*100,l=t.map((function(t){return s(s({},t),{customAttributes:{}})}));t.forEach((function(t){var a,c=t.variantId,d=t.productId,f=t.lineItemHandle,v=t.unitPrice,p=t.quantity,y=void 0===p?0:p,m=t.customAttributes,b=(void 0===m?{}:m)._vajro_flow,_=void 0===b?{}:b,g="string"==typeof _?JSON.parse(_):s({},_),h=g._actualUnitPrice,O=void 0===h?v:h,I=g._freeQuantity,P=void 0===I?0:I,A=i[c]||{},j=A.customAttributes,T=(void 0===j?{}:j)._vajro_flow,w=void 0===T?{}:T,N=y?Number(y)-Number(P):0,U=o?O*(u/100):e,D=w._discountQuantity,x=void 0===D?0:D;i=s(s({},i),((a={})[c]=s(s({},A),{variantId:c,productId:d,lineItemHandle:f,displayText:r,customAttributes:{_vajro_flow:s(s({},w),{_actualUnitPrice:Number(O),_productQuantity:N,_discountPrice:U>=O?O:U,_discountQuantity:U>=O?N:x,_offerPercenatage:u>=100?100:u,_amountTargetId:n,_flatDiscountDetails:{lineItems:l,splitFlatAmount:o,discountValue:e,displayText:r}})}}),a))}))}}return t.forEach((function(t,e){var n=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"amountOffer".concat(e),u=t.discountValue,l=t.getOfferType,d=t.getProducts,f=t.getCollections,p=t.splitFlatAmount,y=t.displayText,m=[];if("products"===l)d.forEach((function(t){var r=t.variantId,e=o[r]||{},i=e.quantity,n=void 0===i?0:i,a=e.customAttributes,c=(void 0===a?{}:a)._vajro_flow,u=void 0===c?{}:c,l=("string"==typeof u?JSON.parse(u):s({},u))._freeQuantity,d=void 0===l?0:l;Number(n)-Number(d)>0&&(m=v(v([],m,!0),[o[r]],!1))}));else if("collections"===l){var b=r.filter((function(t){var r,e=t.quantity,o=void 0===e?0:e,i=t.customAttributes,n=(void 0===i?{}:i)._vajro_flow,a=void 0===n?{}:n,c=(null===(r=null==t?void 0:t.collectionId)||void 0===r?void 0:r.split(","))||[],u=f.some((function(t){var r=t.collectionId;return c.includes(r)})),l=("string"==typeof a?JSON.parse(a):s({},a))._freeQuantity,d=void 0===l?0:l;return u&&Number(o)-Number(d)>0}));b.length>0&&(m=v(v([],m,!0),b,!0))}else m=r.filter((function(t){var r=t.quantity,e=void 0===r?0:r,o=t.customAttributes,i=(void 0===o?{}:o)._vajro_flow,n=void 0===i?{}:i,a=("string"==typeof n?JSON.parse(n):s({},n))._freeQuantity,c=void 0===a?0:a;return Number(e)-Number(c)>0}));var _=a(m),g=s({},i);m=m.filter((function(t){var r=t.variantId,e=t.unitPrice,o=t.customAttributes,i=(void 0===o?{}:o)._vajro_flow,n=void 0===i?{}:i,a=("string"==typeof n?JSON.parse(n):s({},n))._actualUnitPrice,l=void 0===a?e:a,d=(g[r]||{}).customAttributes,f=(void 0===d?{}:d)._vajro_flow,v=void 0===f?{}:f,y=p?l*(u/_):u,m=v._discountPrice,b=void 0===m?0:m,h=v._flatDiscountDetails,O=void 0===h?{}:h,I=v._amountTargetId,P=v.displayText,A=O.lineItems,j=void 0===A?[]:A,T=O.splitFlatAmount,w=void 0!==T&&T,N=O.discountValue,U=void 0===N?0:N;if(y>b){var D=j.filter((function(t){return t.variantId!==r}));w&&D.length>0&&c(D,P,U,w,I)}return y>b})),c(m,y,u,p,n)})),i}(e,h,o)}}));var i=[];Object.values(o).forEach((function(t){var r=t.variantId,e=t.displayTextDetails,n=void 0===e?[]:e,a=t.displayText,c=void 0===a?"":a,u=t.customAttributes;b(b([],n,!0),[c],!1).forEach((function(t){!i.includes(t)&&t&&(i=b(b([],i,!0),[t],!1))})),o[r]=m(m({},t),{customAttributes:u})})),_[r]={offerAppliedProducts:o,displayTextArray:i}}));var U=Object.entries(_).reduce((function(t,r){r[0];var o=r[1],i=t.discountPrice,n=o.offerAppliedProducts,a=o.displayTextArray,c=function(t){return t.reduce((function(t,r){var o=r.customAttributes,i=(void 0===o?{}:o)._vajro_flow,n=void 0===i?{}:i,a="string"==typeof n?JSON.parse(n):e({},n),c=a._actualUnitPrice,u=void 0===c?0:c,l=a._discountPrice,d=void 0===l?0:l,f=a._discountQuantity,s=void 0===f?0:f,v=a._freeQuantity,p=void 0===v?0:v;return t+(Number(u)*(Number(s)+Number(p))+Number(d))}),0)}(Object.values(n));return c>i?{discountPrice:c,offerAppliedDetails:n,displayTextArray:a}:t}),{discountPrice:0,offerAppliedDetails:{},displayTextArray:[]}),D=U.discountPrice,x=U.offerAppliedDetails,Q=function(t){if(0===t.length)return"";var r=t.map((function(t){return'<p style="text-align: center;font-size: 14px"><b>'.concat(t,"</b></p>")})).join("");return'<!DOCTYPE html>\n\t<html lang="en">\n\t\t<head>\n\t\t\t<meta charset="UTF-8" />\n\t\t\t<meta http-equiv="X-UA-Compatible" content="IE=edge" />\n\t\t\t<meta name="viewport" content="width=device-width,initial-scale=1.0" />\n\t\t</head>\n\t\t<body style="min-width: auto; min-height: auto">\n            '.concat(r,"\n\t\t</body>\n\t</html>")}(U.displayTextArray),C=Object.keys(w).reduce((function(t,r){var e;return x[r]?t:m(m({},t),((e={})[r]=w[r],e))}),{});return{discountPrice:D,offerAppliedDetails:x,offerRemovedDetails:C,displayTextHtml:Q}};vajroPlugin=r})();
//# sourceMappingURL=vajroPlugin.js.map
