var vajroPlugin;(()=>{"use strict";var t={d:(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{flow:()=>_});var r=function(){return r=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},r.apply(this,arguments)},o=function(t,e,r){if(r||2===arguments.length)for(var o,i=0,n=e.length;i<n;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},i=function(t){return t.reduce((function(t,e){var i,n,a=e.offerCategory;return t[a]?r(r({},t),((i={})[a]=o(o([],t[a],!0),[e],!1),i)):r(r({},t),((n={})[a]=[e],n))}),{automaticOffers:[],buyXGetY:[],percentageDiscount:[],flatDiscount:[]})},n=function(t){return t.reduce((function(t,e){return t[e.variantId]=e,t}),{})},a=function(t,e){var r={isHaveLineItemHandle:!1,productLineItemHandle:"tempHandle".concat(Math.floor(1e6*Math.random()))};return Object.entries(t).forEach((function(t){var o=t[0],i=t[1],n=r.isHaveLineItemHandle,a=i.variantId;n||e!==a||(r={isHaveLineItemHandle:!0,productLineItemHandle:o})})),r},c=function(t){return t.reduce((function(t,e){var o=e.originalUnitPrice,i=void 0===o?0:o,n=e.quantity,a=void 0===n?0:n,c=e.customAttributes,u=(void 0===c?{}:c)._vajro_flow,l=void 0===u?{}:u,d=("string"==typeof l?JSON.parse(l):r({},l))||{},f=d._actualUnitPrice,s=void 0===f?i:f,v=d._discountQuantity,p=void 0===v?0:v,y=d._freeQuantity;return t+s*(a-(Number(void 0===y?0:y)+Number(p)))}),0)},u=function(t){return t.reduce((function(t,e){var r=e.quantity,o=void 0===r?0:r,i=e.freeQuantity;return t+(o-(void 0===i?0:i))}),0)},l=function(){return l=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},l.apply(this,arguments)},d=function(t,e,r){if(r||2===arguments.length)for(var o,i=0,n=e.length;i<n;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},f=function(){return f=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},f.apply(this,arguments)},s=function(t,e,r){if(r||2===arguments.length)for(var o,i=0,n=e.length;i<n;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},v=function(){return v=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},v.apply(this,arguments)},p=function(t,e,r){if(r||2===arguments.length)for(var o,i=0,n=e.length;i<n;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},y=function(){return y=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},y.apply(this,arguments)},m=function(t,e,r){if(r||2===arguments.length)for(var o,i=0,n=e.length;i<n;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},b=function(){return b=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},b.apply(this,arguments)},g=function(t,e,r){if(r||2===arguments.length)for(var o,i=0,n=e.length;i<n;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},_=function(t,e){var _={},h=t.cartLineItems.lineItems,I=void 0===h?[]:h,O=function(t,e){var r=[],i=[];return t.forEach((function(t){var a=n(e),l=t.cartType,d=t.cartValue,f=t.buyOfferType,s=t.buyProducts,v=t.buyCollections,p=(t.getOfferType,t.discountType,t.getProductCount,t.reccuringFreeProduct,t.getProducts,[]);if("products"===f)s.forEach((function(t){var e=t.variantId;a[e]&&(p=o(o([],p,!0),[a[e]],!1))}));else if("collections"===f){var y=e.filter((function(t){var e,r=(null===(e=null==t?void 0:t.collectionId)||void 0===e?void 0:e.split(","))||[];return v.some((function(t){var e=t.collectionId;return r.includes(e)}))}));y.length>0&&(p=o(o([],p,!0),y,!0))}else p=e;("amount"===l?c(p):u(p))>=d?r=o(o([],r,!0),[t],!1):i=o(o([],i,!0),[t],!1)})),{validConfigList:r,inValidConfigList:i}}(e,I).validConfigList,P=O.reduce((function(t,e,i){var n=t.combinedOfferConfig,a=t.nonCombinedOfferConfig,c=e.combinedOffer;return r(r({},t),c?{combinedOfferConfig:o(o([],n,!0),[r(r({},e),{index:i})],!1)}:{nonCombinedOfferConfig:o(o([],a,!0),[r(r({},e),{index:i})],!1)})}),{combinedOfferConfig:[],nonCombinedOfferConfig:[]}),A=P.combinedOfferConfig,j=void 0===A?[]:A,T=P.nonCombinedOfferConfig,w=void 0===T?[]:T,N=function(t){return t.reduce((function(t,e){var o,i=e.lineItemHandle,n=e.customAttributes,a=void 0===n?{}:n,c=a._vajro_flow,u=void 0===c?{}:c,l="string"==typeof u?JSON.parse(u):r({},u);return-1!==Object.keys(l).indexOf("_actualUnitPrice")?r(r({},t),((o={})[i]=r(r({},e),{customAttributes:r(r({},a),{_vajro_flow:l})}),o)):t}),{})}(I),U={};(null==j?void 0:j.length)>0&&(U.combinedOffer=i(j)),w.forEach((function(t,e){var r=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"offer".concat(e);U[r]=i([t])})),Object.entries(U).forEach((function(t){var e=t[0],r=t[1],o={};Object.entries(r).forEach((function(t){var e=t[0],r=t[1];if(0!==r.length)switch(e){case"automaticOffers":o=function(t,e,r){var o=n(e),i=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"freeOfferTarget";return t.forEach((function(t){var n=t.cartType,f=t.cartValue,s=t.buyOfferType,v=t.buyProducts,p=t.buyCollections,y=t.getProductCount,m=t.reccuringFreeProduct,b=t.getProducts,g=t.displayText,_=[];if("products"===s)v.forEach((function(t){var e=t.variantId;o[e]&&(_=d(d([],_,!0),[o[e]],!1))}));else if("collections"===s){var h=e.filter((function(t){var e,r=(null===(e=null==t?void 0:t.collectionId)||void 0===e?void 0:e.split(","))||[];return p.some((function(t){var e=t.collectionId;return r.includes(e)}))}));h.length>0&&(_=d(d([],_,!0),h,!0))}else _=e;var I="amount"===n?c(_):u(_);if(I>=Number(f)){var O=m?Math.floor(I/f)*y:Number(y);b.forEach((function(t){var e,n,c=t.variantId,u=t.productId,f=t.productPrice,s=a(r,c),v=s.isHaveLineItemHandle,p=s.productLineItemHandle,y=o[c]||{},m=y.lineItemHandle,b=y.quantity,_=void 0===b?0:b,h=y.customAttributes,I=void 0===h?{}:h;m&&(p=m);var P=v||m?r[p]:null,A=I._vajro_flow,j=void 0===A?{}:A,T="string"==typeof j?JSON.parse(j):l({},j),w=T._freeQuantity,N=void 0===w?0:w,U=_?Number(_)-Number(N):0,D=P||{},x=D.customAttributes,Q=(void 0===x?{}:x)._vajro_flow,H=void 0===Q?{}:Q,C=D.displayTextDetails,E=void 0===C?[]:C;O&&P?r=l(l({},r),((e={})[p]=l(l({},P),{displayTextDetails:E.includes(g)?E:d(d([],E,!0),[g],!1),customAttributes:{_vajro_flow:l(l(l({},T),H),{_productQuantity:U,_freeQuantity:Number((null==H?void 0:H._freeQuantity)||0)+O})}}),e)):O&&(r=l(l({},r),((n={})[p]={variantId:c,productId:u,displayTextDetails:[g],lineItemHandle:m,customAttributes:{_vajro_flow:l(l(l({},T),H),{_productQuantity:U,_actualUnitPrice:Number(f),_freeQuantity:O,_productTargetId:i})}},n)))}))}})),r}(r,I,o);break;case"buyXGetY":o=function(t,e,r){var o=n(e),i=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"freeOfferTarget";return t.forEach((function(t,e){var n=t.getProductCount,c=t.getProducts,u=t.displayText;c.forEach((function(t){var e,c,l=t.variantId,d=t.productId,v=t.productPrice,p=a(r,l),y=p.isHaveLineItemHandle,m=p.productLineItemHandle,b=o[l]||{},g=b.quantity,_=void 0===g?0:g,h=b.lineItemHandle,I=b.customAttributes,O=(void 0===I?{}:I)._vajro_flow,P=void 0===O?{}:O,A=("string"==typeof P?JSON.parse(P):f({},P))._freeQuantity,j=void 0===A?0:A,T=_-j>n?n:_-j,w=y?r[m]:null,N=w||{},U=N.customAttributes,D=(void 0===U?{}:U)._vajro_flow,x=void 0===D?{}:D,Q=N.displayTextDetails,H=void 0===Q?[]:Q;T&&w?r=f(f({},r),((e={})[m]=f(f({},w),{displayTextDetails:H.includes(u)?H:s(s([],H,!0),[u],!1),customAttributes:{_vajro_flow:f(f({},x),{_discountQuantity:T+((null==x?void 0:x._discountQuantity)||0),_productTargetId:i})}}),e)):T&&(r=f(f({},r),((c={})[m]={variantId:l,productId:d,lineItemHandle:h,displayTextDetails:[u],customAttributes:{_vajro_flow:f(f({},x),{_productQuantity:_-j,_actualUnitPrice:Number(v),_discountQuantity:T,_productTargetId:i})}},c)))}))})),r}(r,I,o);break;case"percentageDiscount":o=function(t,e,r){var o=n(e);return t.forEach((function(t,i){var n=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"percentageOffer".concat(i),a=t.discountValue,c=t.getOfferType,u=t.getProducts,l=t.getCollections,d=t.displayText,f=[];if("products"===c)u.forEach((function(t){var e=t.variantId;o[e]&&(f=m(m([],f,!0),[o[e]],!1))}));else if("collections"===c){var s=e.filter((function(t){var e,r=(null===(e=null==t?void 0:t.collectionId)||void 0===e?void 0:e.split(","))||[];return l.some((function(t){var e=t.collectionId;return r.includes(e)}))}));s.length>0&&(f=m(m([],f,!0),s,!0))}else f=m([],e,!0);f.forEach((function(t){var e,o=t.variantId,i=t.productId,c=t.lineItemHandle,u=t.originalUnitPrice,l=t.quantity,f=void 0===l?0:l,s=t.customAttributes,v=(void 0===s?{}:s)._vajro_flow,p=void 0===v?{}:v,m="string"==typeof p?JSON.parse(p):y({},p),b=m._actualUnitPrice,g=void 0===b?u:b,_=m._freeQuantity,h=void 0===_?0:_,I=r[c]||{},O=I.customAttributes,P=(void 0===O?{}:O)._vajro_flow,A=void 0===P?{}:P,j=f?Number(f)-Number(h):0,T=g*(a/100),w=A._discountPrice,N=void 0===w?0:w,U=A._discountQuantity,D=void 0===U?0:U;T>N&&j>0&&(r=y(y({},r),((e={})[c]=y(y({},I),{variantId:o,productId:i,lineItemHandle:c,displayText:d,customAttributes:{_vajro_flow:y(y({},A),{_actualUnitPrice:Number(g),_discountPrice:T,_productQuantity:j,_discountQuantity:T===g?j:D,_offerPercenatage:a>=100?100:a,_percentageTargetId:n})}}),e)))}))})),r}(r,I,o);break;case"flatDiscount":o=function(t,e,r){var o=n(e),i=v({},r);function a(t,e,r,o,n){if(0!==t.length){var a=c(t),u=r/a*100,l=t.map((function(t){return v(v({},t),{customAttributes:{}})}));t.forEach((function(t){var a,c=t.variantId,d=t.productId,f=t.lineItemHandle,s=t.originalUnitPrice,p=t.quantity,y=void 0===p?0:p,m=t.customAttributes,b=(void 0===m?{}:m)._vajro_flow,g=void 0===b?{}:b,_="string"==typeof g?JSON.parse(g):v({},g),h=_._actualUnitPrice,I=void 0===h?s:h,O=_._freeQuantity,P=void 0===O?0:O,A=i[f]||{},j=A.customAttributes,T=(void 0===j?{}:j)._vajro_flow,w=void 0===T?{}:T,N=y?Number(y)-Number(P):0,U=o?I*(u/100):r,D=w._discountQuantity,x=void 0===D?0:D;i=v(v({},i),((a={})[f]=v(v({},A),{variantId:c,productId:d,lineItemHandle:f,displayText:e,customAttributes:{_vajro_flow:v(v({},w),{_actualUnitPrice:Number(I),_productQuantity:N,_discountPrice:U>=I?I:U,_discountQuantity:U>=I?N:x,_offerPercenatage:u>=100?100:u,_amountTargetId:n,_flatDiscountDetails:{lineItems:l,splitFlatAmount:o,discountValue:r,displayText:e}})}}),a))}))}}return t.forEach((function(t,r){var n=(null===crypto||void 0===crypto?void 0:crypto.randomUUID)&&(null===crypto||void 0===crypto?void 0:crypto.randomUUID())||"amountOffer".concat(r),u=t.discountValue,l=t.getOfferType,d=t.getProducts,f=t.getCollections,s=t.splitFlatAmount,y=t.displayText,m=[];if("products"===l)d.forEach((function(t){var e=t.variantId,r=o[e]||{},i=r.quantity,n=void 0===i?0:i,a=r.customAttributes,c=(void 0===a?{}:a)._vajro_flow,u=void 0===c?{}:c,l=("string"==typeof u?JSON.parse(u):v({},u))._freeQuantity,d=void 0===l?0:l;Number(n)-Number(d)>0&&(m=p(p([],m,!0),[o[e]],!1))}));else if("collections"===l){var b=e.filter((function(t){var e,r=t.quantity,o=void 0===r?0:r,i=t.customAttributes,n=(void 0===i?{}:i)._vajro_flow,a=void 0===n?{}:n,c=(null===(e=null==t?void 0:t.collectionId)||void 0===e?void 0:e.split(","))||[],u=f.some((function(t){var e=t.collectionId;return c.includes(e)})),l=("string"==typeof a?JSON.parse(a):v({},a))._freeQuantity,d=void 0===l?0:l;return u&&Number(o)-Number(d)>0}));b.length>0&&(m=p(p([],m,!0),b,!0))}else m=e.filter((function(t){var e=t.quantity,r=void 0===e?0:e,o=t.customAttributes,i=(void 0===o?{}:o)._vajro_flow,n=void 0===i?{}:i,a=("string"==typeof n?JSON.parse(n):v({},n))._freeQuantity,c=void 0===a?0:a;return Number(r)-Number(c)>0}));var g=c(m),_=v({},i);m=m.filter((function(t){var e=t.variantId,r=t.lineItemHandle,o=t.originalUnitPrice,i=t.customAttributes,n=(void 0===i?{}:i)._vajro_flow,c=void 0===n?{}:n,l=("string"==typeof c?JSON.parse(c):v({},c))._actualUnitPrice,d=void 0===l?o:l,f=(_[r]||{}).customAttributes,p=(void 0===f?{}:f)._vajro_flow,y=void 0===p?{}:p,m=s?d*(u/g):u,b=y._discountPrice,h=void 0===b?0:b,I=y._flatDiscountDetails,O=void 0===I?{}:I,P=y._amountTargetId,A=y.displayText,j=O.lineItems,T=void 0===j?[]:j,w=O.splitFlatAmount,N=void 0!==w&&w,U=O.discountValue,D=void 0===U?0:U;if(m>h){var x=T.filter((function(t){return t.variantId!==e}));N&&x.length>0&&a(x,A,D,N,P)}return m>h})),a(m,y,u,s,n)})),i}(r,I,o)}}));var i=[];Object.values(o).forEach((function(t){var e=t.displayTextDetails,r=void 0===e?[]:e,o=t.displayText,n=void 0===o?"":o;g(g([],r,!0),[n],!1).forEach((function(t){!i.includes(t)&&t&&(i=g(g([],i,!0),[t],!1))}))})),_[e]={offerAppliedProducts:o,displayTextArray:i}}));var D=Object.entries(_).reduce((function(t,e){e[0];var o=e[1],i=t.discountPrice,n=o.offerAppliedProducts,a=o.displayTextArray,c=function(t){return t.reduce((function(t,e){var o=e.customAttributes,i=(void 0===o?{}:o)._vajro_flow,n=void 0===i?{}:i,a="string"==typeof n?JSON.parse(n):r({},n),c=a._actualUnitPrice,u=void 0===c?0:c,l=a._discountPrice,d=void 0===l?0:l,f=a._discountQuantity,s=void 0===f?0:f,v=a._freeQuantity,p=void 0===v?0:v;return t+(Number(u)*(Number(s)+Number(p))+Number(d))}),0)}(Object.values(n));return c>=i?{discountPrice:c,offerAppliedDetails:n,displayTextArray:a}:t}),{discountPrice:0,offerAppliedDetails:{},displayTextArray:[]}),x=D.discountPrice,Q=D.offerAppliedDetails,H=function(t){if(0===t.length)return"";var e=t.map((function(t){return'<p style="text-align: center;font-size: 14px"><b>'.concat(t,"</b></p>")})).join("");return'<!DOCTYPE html>\n\t<html lang="en">\n\t\t<head>\n\t\t\t<meta charset="UTF-8" />\n\t\t\t<meta http-equiv="X-UA-Compatible" content="IE=edge" />\n\t\t\t<meta name="viewport" content="width=device-width,initial-scale=1.0" />\n\t\t</head>\n\t\t<body style="min-width: auto; min-height: auto">\n            '.concat(e,"\n\t\t</body>\n\t</html>")}(D.displayTextArray),C=Object.keys(N).reduce((function(t,e){var r;return Q[e]?t:b(b({},t),((r={})[e]=N[e],r))}),{});return{discountPrice:x,offerAppliedDetails:Q,offerRemovedDetails:C,displayTextHtml:H}};vajroPlugin=e})();
//# sourceMappingURL=vajroPlugin.js.map
